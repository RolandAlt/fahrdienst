# === Fahrdienst-App Backup (inkl. Hauptverzeichnis- & lib-Dateien) ===

$source = "C:\FlutterProjekte\stammdaten_app"
$target = "C:\Backups\FahrdienstApp_Backup_$(Get-Date -Format yyyy-MM-dd_HH-mm)"
New-Item -ItemType Directory -Force -Path $target | Out-Null

function Copy-Rel($relPath) {
  $src = Join-Path $source $relPath
  if (Test-Path $src) {
    $dst = Join-Path $target $relPath
    New-Item -ItemType Directory -Force -Path (Split-Path $dst -Parent) | Out-Null
    Copy-Item $src $dst -Recurse -Force
    Write-Host "‚úîÔ∏è Gesichert: $relPath"
  } else {
    Write-Host "‚ö†Ô∏è Nicht gefunden: $relPath"
  }
}

# === 1) Alle Dateien im Hauptverzeichnis sichern ===
$rootFiles = Get-ChildItem -Path $source -File | ForEach-Object { $_.Name }

# === 2) Alle Dateien & Unterordner in /lib sichern ===
$libFiles = Get-ChildItem -Path (Join-Path $source "lib") -Recurse -File |
  ForEach-Object { $_.FullName.Substring($source.Length + 1) }

# === 3) Wichtige definierte Projektdateien (wie zuvor) ===
$paths = @(
  "pubspec.yaml",
  "pubspec.lock",
  "analysis_options.yaml",
  "android\build.gradle", "android\build.gradle.kts",
  "android\settings.gradle", "android\settings.gradle.kts",
  "android\app\build.gradle", "android\app\build.gradle.kts",
  "android\gradle.properties",
  "android\app\src\main\AndroidManifest.xml",
  "android\app\src\main\res",
  "assets",
  "flutter_launcher_icons.yaml",
  "flutter_native_splash.yaml",
  "android\app\keystore.properties",
  "android\app\key.jks",
  "android\app\google-services.json",
  "assets\credentials\service_key.json",
  "build\app\outputs\apk\release\app-release.apk"
)

# === 4) Alles zusammen sichern ===
($rootFiles + $libFiles + $paths) | Sort-Object -Unique | ForEach-Object { Copy-Rel $_ }

Write-Host "`n‚úÖ Backup abgeschlossen!"
Write-Host "üìÅ Gespeichert unter: $target"
